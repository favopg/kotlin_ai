<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Kotlin APIサンプル</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container" style="max-width: 960px;">
        <div class="row min-vh-100">
            <!-- 左サイドメニュー（ダーク） -->
            <aside class="col-12 col-md-3 col-lg-2 bg-dark text-white p-3">
                <h5 class="mb-4">メニュー</h5>
                <nav class="nav nav-pills flex-column gap-2">
                    <a class="nav-link text-white bg-secondary" href="index.html">検索</a>
                    <a class="nav-link text-white bg-secondary" href="register.html">登録</a>
                </nav>
            </aside>

            <!-- 右サイド コンテンツ枠 -->
            <main class="col-12 col-md-9 col-lg-10 p-4">
                <div class="card shadow-sm">
                    <div class="card-header">コンテンツ</div>
                    <div id="app" class="card-body">
                        <!-- 円グラフ（右サイドコンテンツの一番上） -->
                        <div class="mb-4">
                            <h5 class="card-title mb-2">円グラフ</h5>
                            <div class="ratio ratio-1x1" style="max-width: 420px;">
                                <canvas id="categoryPieChart" aria-label="カテゴリー別支出円グラフ" role="img"></canvas>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-sm table-striped align-middle mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th scope="col">ID</th>
                                        <th scope="col">カテゴリー</th>
                                        <th scope="col">金額</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="item in items" :key="item.id">
                                        <td><a :href="'#' + item.id">{{ item.id }}</a></td>
                                        <td>{{ item.category }}</td>
                                        <td>{{ item.amount }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    items: [
                        { id: 1, category: '食費', amount: '¥1,000' },
                        { id: 2, category: '交通', amount: '¥2,000' },
                        { id: 3, category: '住居', amount: '¥3,000' },
                        { id: 4, category: '光熱費', amount: '¥4,000' },
                        { id: 5, category: '娯楽', amount: '¥5,000' },
                        { id: 6, category: '教育', amount: '¥6,000' },
                        { id: 7, category: '医療', amount: '¥7,000' },
                        { id: 8, category: '日用品', amount: '¥8,000' },
                        { id: 9, category: '通信', amount: '¥9,000' },
                        { id: 10, category: 'その他', amount: '¥10,000' }
                    ],
                    _chart: null
                }
            },
            methods: {
                parseAmount(val) {
                    if (typeof val === 'number') return val;
                    const n = String(val).replace(/[^\d.-]/g, '');
                    return Number(n || 0);
                },
                buildChart() {
                    const totals = {};
                    for (const it of this.items) {
                        totals[it.category] = (totals[it.category] || 0) + this.parseAmount(it.amount);
                    }
                    const labels = Object.keys(totals);
                    const data = Object.values(totals);
                    const ctx = document.getElementById('categoryPieChart');
                    if (!ctx) return;
                    if (this._chart) {
                        this._chart.destroy();
                    }
                    this._chart = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels,
                            datasets: [{
                                data,
                                backgroundColor: ['#4e79a7','#f28e2b','#e15759','#76b7b2','#59a14f','#edc948','#b07aa1','#ff9da7','#9c755f','#bab0ab'],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            plugins: {
                                legend: { position: 'bottom' },
                                title: { display: true, text: 'カテゴリー別支出' }
                            }
                        }
                    });
                }
            },
            mounted() {
                this.buildChart();
            }
        }).mount('#app');
    </script>
</body>
</html>
